# 방탈출 결제 / 배포

---

## 리뷰어 가이드
이번 미션은 **외부 API 연동 경험**을 중심으로 설계되었습니다.  <br>
백엔드 개발 과정에서 API 연동은 매우 흔한 작업이며, 리뷰어분들께는 익숙한 요구사항일 것으로 예상합니다.<br>
이번 미션은 **API 연동이 처음인 신입 개발자**를 가정하고, 아래와 같은 요구사항을 설계했습니다:
- 외부 API 응답이 **성공한 경우**: 필요한 데이터를 저장
- 외부 API 응답이 **실패한 경우**: 에러를 적절히 핸들링하고, 명확한 메시지를 작성 <br>

💡 **복잡한 결제 도메인 자체는 학습 목표가 아닙니다.😄** <br>
Toss 결제 API를 사용하는 이유는 친절한 문서가 있고, 기존 방탈출 미션의 ‘예약’과 자연스럽게 연결되기 때문입니다.
결제 도메인을 깊게 학습하려는 목적은 전혀 없습니다.

### 🎯 학습목표 & 리뷰 범위
✅ **핵심 학습 목표는 외부 API 호출과 연동 방식의 이해와 구현입니다.** <br> 
결제 시스템 연동 시 일반적으로 고려하는 요소들 `예: 보안, 내/외부 시스템의 데이터 정합성, DB 트랜잭션 처리(ex.롤백) 등` 은 이번 미션에서 다루지 않습니다.
결제 도메인의 심화 요소들은 크루들이 현재 단계에서 소화하기 어렵고, 일부 키워드는 레벨3,4에서 깊게 학습 할 예정입니다.

✅ **학습 목표에 포함되지 않은 요구사항(예: 결제 취소 구현 등)은 리뷰 대상이 아닙니다.**  
이 점은 크루들에게도 수업과 LMS를 통해 명확하게 안내했습니다.
> 따라서, **리뷰 범위를 벗어난 코드에 대해서는 선택적으로 리뷰하실 수 있습니다.**  
> 리뷰어의 불필요한 부담을 줄이고, 학습 목표 중심의 피드백에 집중하실 수 있도록 이와 같은 방향으로 설계했습니다. 😊

크루가 자발적으로 학습 목표 외의 기능을 확장해 구현하는 경우, 개인 학습 범위로 바라보고 허용하되  
코치와 리뷰어 모두 이에 대해 특별한 피드백은 하지 않는 방식으로 운영해보려 합니다.

✅ 이번 미션에서는 **일부러 사용할 HTTP Client나 테스트 작성 여부를 지정하지 않았습니다.**  
크루가 직접 기술을 선택하고, 그 근거를 고민해보도록 유도하려는 의도입니다. <br>
리뷰 과정에서 해당 의사결정의 이유를 물어봐 주세요.  
자신의 결정을 설명하는 과정은 크루가 스스로의 학습 상태를 메타인지 하는 데 큰 도움이 됩니다.

---

## 경험해야할 학습 목표

- 외부 API(third party API)를 연동하는 경험
- 외부 API(third party API) 연동 시, 에러 핸들링
- 신규 도메인(결제) 추가 시, 설계 및 구현
- 외부 API 연동 시, 테스트 전략 선택 및 테스트 

## 결제 API 연동 작업에서 미션 작업 범위
- 결제 성공시, API call flow 
![방탈출 토스결제 성공 시퀀스 다이어그램](https://github.com/woowacourse/woowacourse-docs/assets/120355873/50a324f1-29c4-4e81-baa6-eb47852175f5)

---

## 리뷰 포인트

### 1단계
- 외부 API(third party API)를 연동 시 적절한 기술적 의사결정을 했는가?
  - 구현 시 사용한 HTTP Client를 선택한 이유는 무엇인가? 선택 과정에서 충분한 리서치와, 합리적인 고민이 있었는가?
  - timeout 시간을 설정했는가? 설정했다면, 특정 시간으로 설정한 이유는 무엇인가?
  

- 외부 API 연동 에러 핸들링을 충분히 구현했는가?
  - 외부 API 호출 실패 시 받은 결제 에러 사유를 사용자도 확인 할 수 있는가?
  - HTTP Client가 API 호출에 실패 했을때 발생하는 예외(ex.RestClientException)가 별도의 처리없이 상위로 전파되거나 사용자에게 노출되지 않고, 예외가 전환되도록 처리했는가?
  - 예외 전환 시, 원래 발생한 예외(cause exception)에 대한 로그를 확인 할 수 있는가?
  - timeout 에 대한 고려를 했는가? timeout 설정이 추가되어 있는가? 


- 연동 작업에 필요한 테스트가 있는가? 해당 테스트 방식이 테스트 목적에 적절한가?
  - 테스트 타겟과 목적이 무엇인가? 원하는 테스트 목적과 타겟에 맞는 테스트 방식을 선택했는가?
    - ex1. 외부 API의 정상동작 확인이 목적이라면 curl로 toss API를 호출해보는 것도 하나의 테스트 방법이다.
    - ex2. 테스트코드에서 반복적인 외부 API 호출을 하지 말아한다고 판단해서, 구현해두고 `@Disabled`를 사용할 수도 있다.
    - ex3. 코드에서 API 호출 부분을 mocking 할 수도 있다.
  - 테스트 방식이 한 가지가 아니기 떄문에, 테스트 작성자의 의도와 해결하려는 방식이 적합한지가 더 중요하다. 

### 2단계
- 신규 도메인으로 결제를 추가하고, DB를 적절히 설계했는가?
  - 외부 API의 결제 응답에서, 특정 필드만 선택해 도메인을 설계 했을 때 그 이유는 무엇인가? 저장하지 않는 값에 대한 결정 근거는 무엇인가? 
  - 외부 API의 응답 필드 중에서 원하는 필드만 선택적으로 저장하고, 가져올 수 있는가?

  
- 기존 도메인인 예약과 결제의 DB 연관관계가 적절하게 맵핑되었는가?  
  - 결제가 없는 예약도 가능하다는 정책을 가정했다면(ex.현재 관리자 페이지에서는 결제없이 예약이 가능), 연관 관계가 적절한가?
  - 결제와 예약의 상태를 일치시켜야 하는 것은 필수 요구사항이 아님(ex.결제 실패시, 예약도 실패)

### 4단계
레벨2 마지막 미션인 만큼, 프로젝트를 완성도 높게 마무리하고
레벨3에서 다른 개발자와 협업 할 준비를 하는 의미로 API문서와 ERD 작성, 로깅 요구사항을 포함했습니다.
- 다른 개발자가 이해하기 쉬운 API 문서인가? 
  - API 연동 시 필요한 정보가 누락되지 않았는가?
- 자신과 팀이 유지보수하기 쉬운 문서인가?
- DB ERD 문서가 코드에서 구현한 테이블 맵핑과 일치하는가?
  - 관계형 DB의 테이블 간의 관계(ex.1:n/ 1:0...N / 1:1 등)가 잘 표현되어있는가?
- DB 테이블에서 기초적인 설계사항을 지켰는가?
  - ex. pk,uk 사용이 적절한가, 컬럼의 데이터 타입이 합리적인가?  
- 로그 레벨의 적용 기준이 적절한가?
- 에러 발생시, 원인과 에러 맥락을 확인 할 수 있는 데이터를 포함해 로그를 남기고 있는가? (ex.주요 식별자, 스택트레이스 등)   
